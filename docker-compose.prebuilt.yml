# Use this file for quick deployment with pre-built images (no build required)
# Usage: docker-compose -f docker-compose.prebuilt.yml up -d

services:
    tabby:
        image: ghcr.io/eugeny/tabby-web:latest
        restart: always
        depends_on:
        - db
        ports:
        - 9090:80
        environment:
        - DATABASE_URL=mysql://root:123@db/tabby
        - PORT=80
        - DEBUG=False
        - DOCKERIZE_ARGS="-wait tcp://db:3306 -timeout 60s"
        #
        # ============================================================
        # Authentication Options (choose one or more)
        # ============================================================
        #
        # Option 1: Local username/password (no OAuth required!)
        # - LOCAL_AUTH_ENABLED=true
        # - LOCAL_AUTH_REGISTRATION_ENABLED=true  # Allow self-registration
        #
        # Option 2: Proxy authentication (Authentik, Authelia, etc.)
        # - PROXY_AUTH_ENABLED=true
        #
        # Option 3: OAuth Providers (uncomment and configure):
        # - SOCIAL_AUTH_GITHUB_KEY=your_github_client_id
        # - SOCIAL_AUTH_GITHUB_SECRET=your_github_client_secret
        # - SOCIAL_AUTH_GITLAB_KEY=your_gitlab_client_id
        # - SOCIAL_AUTH_GITLAB_SECRET=your_gitlab_client_secret
        # - SOCIAL_AUTH_GOOGLE_OAUTH2_KEY=your_google_client_id
        # - SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET=your_google_client_secret
        # - SOCIAL_AUTH_MICROSOFT_GRAPH_KEY=your_microsoft_client_id
        # - SOCIAL_AUTH_MICROSOFT_GRAPH_SECRET=your_microsoft_client_secret
        # - SOCIAL_AUTH_AUTH0_DOMAIN=your_tenant.auth0.com
        # - SOCIAL_AUTH_AUTH0_KEY=your_auth0_client_id
        # - SOCIAL_AUTH_AUTH0_SECRET=your_auth0_client_secret
        #
        # ============================================================
        # Other Settings
        # ============================================================
        # - ALLOWED_HOSTS=tabby.example.com,localhost
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:80/health"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s

    db:
        image: mariadb:10.7.1
        restart: always
        environment:
            MARIADB_DATABASE: tabby
            MARIADB_USER: user
            MARIADB_PASSWORD: 123
            MYSQL_ROOT_PASSWORD: 123
        volumes:
        - db-data:/var/lib/mysql

volumes:
    db-data:
